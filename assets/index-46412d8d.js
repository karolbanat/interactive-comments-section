(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(r){if(r.ep)return;r.ep=!0;const c=n(r);fetch(r.href,c)}})();let f;const B=new Uint8Array(16);function O(){if(!f&&(f=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!f))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return f(B)}const i=[];for(let t=0;t<256;++t)i.push((t+256).toString(16).slice(1));function N(t,e=0){return(i[t[e+0]]+i[t[e+1]]+i[t[e+2]]+i[t[e+3]]+"-"+i[t[e+4]]+i[t[e+5]]+"-"+i[t[e+6]]+i[t[e+7]]+"-"+i[t[e+8]]+i[t[e+9]]+"-"+i[t[e+10]]+i[t[e+11]]+i[t[e+12]]+i[t[e+13]]+i[t[e+14]]+i[t[e+15]]).toLowerCase()}const P=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),v={randomUUID:P};function R(t,e,n){if(v.randomUUID&&!e&&!t)return v.randomUUID();t=t||{};const o=t.random||(t.rng||O)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,e){n=n||0;for(let r=0;r<16;++r)e[n+r]=o[r];return e}return N(o)}const S="appData";async function H(){const t=localStorage.getItem(S);let e;return t?e=JSON.parse(t):e=await $(),e}async function $(){return await(await fetch("./data.json")).json()}function m(t){localStorage.setItem(S,JSON.stringify(t))}const I=document.querySelector("#global-comment-form"),V=I.querySelector('button[type="submit"]');function M(t){t.preventDefault();const o=t.target.closest("form").querySelector("textarea"),r=h(o.value);if(b(r.content))return;const c=Ee(r);le(c),o.value=""}function k(t){t.preventDefault();const n=t.target.closest("form"),o=n.querySelector("textarea"),r=h(o.value);if(b(r.content))return;const c=n.dataset.commentId;if(!c)return;const a=Se(c,r);a&&me(a)}function j(t){t.preventDefault();const n=t.target.closest("form"),o=n.querySelector("textarea"),r=h(o.value);if(b(r.content))return;const c=n.dataset.replyId;if(!c)return;const a=ve(r,c);n.remove(),a&&pe(a,c)}function h(t){const e=(t.match(/^@\S+/)||[void 0])[0];return{content:t.replace(/^@\S+/,"").trim(),replyingTo:e==null?void 0:e.replace(/@/gi,"")}}function b(t){return t===""}const l=document.querySelector("#delete-confirmation-modal"),T=l.querySelector("#cancel-button"),Y=l.querySelector("#confirm-delete-button");let y;function J(t){l.dataset.open="true",K(),T.focus(),y=t}function w(){l.dataset.open="false",W()}function K(){var e;const t=document.createElement("div");t.classList.add("modal-dropshadow"),(e=l.parentNode)==null||e.insertBefore(t,l.nextSibling)}function W(){const t=document.querySelector(".modal-dropshadow");t&&t.remove()}T.addEventListener("click",w);Y.addEventListener("click",()=>{w(),y(),y=()=>{}});const z=document.querySelector("#comments-container");function G(t){const e=E(t);e.id="comments-list",z.appendChild(e)}function E(t,e=!1){const n=document.createElement("ul");n.classList.add("comments-grid");for(const o of t)n.appendChild(g(o,e));return n}function g(t,e=!1){const n=document.createElement("li");return n.classList.add("comments-grid"),n.appendChild(Q(t,ye(t.user.username),e)),t.replies&&t.replies.length>0&&(n.classList.add("comments-grid"),n.appendChild(E(t.replies,!0))),n}function Q(t,e=!1,n=!1){const o=document.createElement("div");return o.classList.add("comment"),o.dataset.id=t.id.toString(),o.dataset.reply=n.toString(),e&&(o.dataset.currentUser="true"),o.appendChild(X(t.user,t.createdAt)),o.appendChild(A(t.content,t.replyingTo)),o.appendChild(ne(t.score)),o.appendChild(re(e)),o}function X(t,e){const n=document.createElement("div");return n.classList.add("comment__header"),n.appendChild(x(t.image)),n.appendChild(Z(t.username)),n.appendChild(ee(e)),n}function x(t){const e=document.createElement("picture"),n=document.createElement("source");n.setAttribute("srcset",t.webp),n.setAttribute("type","image/webp");const o=document.createElement("img");return o.setAttribute("src",t.png),o.setAttribute("alt",""),o.classList.add("user-avatar"),e.appendChild(n),e.appendChild(o),e}function Z(t){const e=document.createElement("span");return e.classList.add("comment__username"),e.innerText=t,e}function ee(t){const e=document.createElement("span");return e.innerText=t,e}function A(t,e){const n=document.createElement("div");return n.classList.add("comment__content"),n.appendChild(te(t,e)),n}function te(t,e){const n=document.createElement("p");if(e){const o=document.createElement("span");o.innerText=`@${e} `,n.appendChild(o)}return n.appendChild(document.createTextNode(t)),n}function ne(t){const e=document.createElement("div");e.classList.add("score"),e.classList.add("comment__score");const n=document.createElement("span");return n.innerText=t.toString(),e.appendChild(L("UPVOTE","./images/icon-plus.svg")),e.appendChild(n),e.appendChild(L("DOWNVOTE","./images/icon-minus.svg")),e}function L(t,e){const n=document.createElement("button");return n.classList.add("score__vote-button"),n.setAttribute("aria-label",t.toLowerCase()),n.appendChild(oe(e)),n.addEventListener("click",o=>{const r=o.target,c=r.closest(".comment");if(!c||Boolean(c.dataset.currentUser))return;const a=r.closest(".score");if(!a)return;const p=a.querySelector("span");if(!p)return;const _=t==="UPVOTE"?he(c.dataset.id):be(c.dataset.id);p.innerText=_.toString()}),n}function oe(t){const e=document.createElement("img");return e.setAttribute("src",t),e.setAttribute("alt",""),e}function re(t=!1){const e=document.createElement("div");return e.classList.add("flex-align-center"),e.classList.add("comment__actions"),t?(e.appendChild(C("DELETE")),e.appendChild(C("EDIT"))):e.appendChild(C("REPLY")),e}function C(t){const e=document.createElement("button");return e.classList.add("action-button"),e.classList.add(`action-button--${t.toLowerCase()}`),e.innerText=t.toLowerCase(),e.addEventListener("click",ce(t)),e}function ce(t){switch(t){case"DELETE":return se;case"EDIT":return ie;case"REPLY":return ae;default:return()=>{}}}function se(t){const n=t.target.closest(".comment");if(!n)return;const o=n.dataset.id;J(()=>{Le(o),fe(o)})}function ie(t){const n=t.target.closest(".comment");if(!n)return;const o=n.dataset.id,r=n.querySelector(".comment__content");r&&(D(r),r.appendChild(de(o)))}function ae(t){var c;const n=t.target.closest(".comment");if(!n)return;const o=n.dataset.id,r=ue(o);(c=n.parentNode)==null||c.insertBefore(r,n.nextSibling)}function D(t){t.innerHTML=""}function de(t){const e=document.createElement("form");e.classList.add("comment-form"),e.classList.add("comment-form--edit"),e.classList.add("edit-form-grid"),e.dataset.commentId=t;const n=U(Te(t),"Edit comment","comment-edit"),o=F("Update");return o.addEventListener("click",k),e.appendChild(n),e.appendChild(o),e}function ue(t){const e=document.createElement("form");e.classList.add("comment-form"),e.classList.add("comment-form-grid"),e.dataset.replyId=t;const n=x(Ce().image);n.dataset.area="avatar";const o=U(we(t),"Reply comment","comment-reply");o.dataset.area="input";const r=F("Reply");return r.dataset.area="submit",r.addEventListener("click",j),e.appendChild(n),e.appendChild(o),e.appendChild(r),e}function U(t="",e="Comment",n="comment"){const o=document.createElement("textarea");return o.setAttribute("aria-label",e),o.name=n,o.value=t,o}function F(t="Send"){const e=document.createElement("button");return e.classList.add("button"),e.classList.add("button--primary"),e.type="submit",e.innerText=t,e}function le(t){const e=g(t),n=document.querySelector("#comments-list");n==null||n.appendChild(e)}function me(t){const e=document.querySelector(`[data-id="${t.id}"]`);if(!e)return;const n=e.querySelector(".comment__content");n&&(D(n),n.appendChild(A(t.content,t.replyingTo)))}function pe(t,e){var o,r,c,a,p;const n=document.querySelector(`[data-id="${e}"]`);n&&((o=n.closest("ul"))!=null&&o.id&&((r=n.closest("ul"))==null?void 0:r.id)==="comments-list"?((c=n.nextSibling)==null?void 0:c.nodeName)==="UL"?n.nextSibling.appendChild(g(t,!0)):(a=n.parentNode)==null||a.insertBefore(E([t],!0),n.nextSibling):(p=n.closest("ul"))==null||p.appendChild(g(t,!0)))}function fe(t){var o;const e=document.querySelector(`[data-id="${t}"]`),n=e==null?void 0:e.closest("ul");(o=e==null?void 0:e.closest("li"))==null||o.remove(),n&&n.children.length===0&&n.remove()}let d=[],s;function ge(){H().then(t=>{d=[...t.comments],s=t.currentUser,G(d)})}function Ce(){return{...s}}function ye(t){return t===s.username}function he(t){const e=u(t);return e?(s.upvoted.includes(t)||(s.downvoted.includes(t)&&(s.downvoted=s.downvoted.filter(n=>n!==t),e.score++),s.upvoted=[...s.upvoted,t],e.score++,m({currentUser:s,comments:d})),e.score):0}function be(t){const e=u(t);return e?(s.downvoted.includes(t)||(s.upvoted.includes(t)&&(s.upvoted=s.upvoted.filter(n=>n!==t),e.score--),s.downvoted=[...s.downvoted,t],e.score--,m({currentUser:s,comments:d})),e.score):0}function Ee(t){const e=q(t);return d=[...d,e],m({currentUser:s,comments:d}),e}function ve(t,e){const n=u(e);if(!n)return null;const o=q(t);if(n.replies)n.replies=[...n.replies,o];else{const r=xe(e);if(!r)return null;r.replies=[...r.replies||[],o]}return m({currentUser:s,comments:d}),o}function Le(t){const e=u(t);return e?(d=d.filter(n=>n.id!==t),d.forEach(n=>{var o;return n.replies=(o=n.replies)==null?void 0:o.filter(r=>r.id!==t)}),m({currentUser:s,comments:d}),e):null}function Se(t,e){const n=u(t);return n?(n.content=e.content,e.replyingTo?n.replyingTo=e.replyingTo:delete n.replyingTo,m({currentUser:s,comments:d}),n):null}function Te(t){const e=u(t);return e?e.replyingTo?`@${e.replyingTo} ${e.content}`:e.content:""}function we(t){const e=u(t);return e?`@${e.user.username}`:""}function q(t){const e={id:R(),content:t.content,createdAt:"few seconds ago",score:0,user:s};return t.replyingTo?e.replyingTo=t.replyingTo:e.replies=[],e}function xe(t){var e;for(const n of d){if(n.id.toString()===t)return null;const o=(e=n.replies)==null?void 0:e.filter(r=>r.id.toString()===t);if(o&&o.length>0)return n}return null}function u(t){for(const e of d){if(e.id.toString()===t)return e;if(e.replies){for(const n of e.replies)if(n.id.toString()===t)return n}}return null}ge();V.addEventListener("click",M);
